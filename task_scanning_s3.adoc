---
sidebar: sidebar
permalink: task_scanning_s3.html
keywords: cloud compliance, amazon s3, s3 buckets, amazon s3 buckets, scan s3 buckets, scan amazon s3 buckets, enable compliance s3, enable compliance on s3, s3 working environment
summary: Cloud Compliance can scan your Amazon S3 buckets to identify the personal and sensitive data that resides in S3 object storage. Cloud Compliance can scan any bucket in the account, regardless if it was created for a NetApp solution.
---

= Getting started with Cloud Compliance for Amazon S3
:hardbreaks:
:nofooter:
:icons: font
:linkattrs:
:imagesdir: ./media/

[.lead]
Cloud Compliance can scan your Amazon S3 buckets to identify the personal and sensitive data that resides in S3 object storage. Cloud Compliance can scan any bucket in the account, regardless if it was created for a NetApp solution.

== Quick start

Get started quickly by following these steps, or scroll down to the remaining sections for full details.

==== image:number1.png[Number 1] Set up the S3 requirements in your cloud environment

[role="quick-margin-para"]
Ensure that your cloud environment can meet the requirements for Cloud Compliance, including preparing an IAM role and setting up connectivity from Cloud Compliance to S3. <<Reviewing S3 prerequisites,See the complete list>>.

==== image:number2.png[Number 2] Deploy the Cloud Compliance instance

[role="quick-margin-para"]
link:task_deploy_cloud_compliance.html[Deploy Cloud Compliance^] if there isn't already an instance deployed.

==== image:number3.png[Number 3] Activate Compliance on your S3 working environment

[role="quick-margin-para"]
Select the Amazon S3 working environment, click *Enable Compliance*, and select an IAM role that includes the required permissions.

==== image:number4.png[Number 4] Select the buckets to scan

[role="quick-margin-para"]
Select the buckets that you'd like to scan and Cloud Compliance will start scanning them.

== Reviewing S3 prerequisites

The following requirements are specific to scanning S3 buckets.

[[policy-requirements]]

Set up an IAM role for the Cloud Compliance instance::
Cloud Compliance needs permissions to connect to the S3 buckets in your account and to scan them. Set up an IAM role that includes the permissions listed below. Cloud Manager prompts you to select an IAM role when you enable Cloud Compliance on the Amazon S3 working environment.
+
[source,json]
{
  "Version": "2012-10-17",
  "Statement": [
      {
          "Effect": "Allow",
          "Action": [
              "s3:Get*",
              "s3:List*",
              "s3:PutObject",
              "s3:HeadBucket"
          ],
          "Resource": "*"
      },
      {
          "Effect": "Allow",
          "Action": [
              "iam:GetPolicyVersion",
              "iam:GetPolicy",
              "iam:ListAttachedRolePolicies"
          ],
          "Resource": [
              "arn:aws:iam::*:policy/*",
              "arn:aws:iam::*:role/*"
          ]
      }
  ]
}

Provide connectivity from Cloud Compliance to Amazon S3::
Cloud Compliance needs a connection to Amazon S3. The best way to provide that connection is through a VPC Endpoint to the S3 service. For instructions, see https://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/vpce-gateway.html#create-gateway-endpoint[AWS Documentation: Creating a Gateway Endpoint^].
+
When you create the VPC Endpoint, be sure to select the region, VPC, and route table that corresponds to the Cloud Compliance instance. You must also modify the security group to add an outbound HTTPS rule that enables traffic to the S3 endpoint. Otherwise, Cloud Compliance can't connect to the S3 service.
+
If you experience any issues, see https://aws.amazon.com/premiumsupport/knowledge-center/connect-s3-vpc-endpoint/[AWS Support Knowledge Center: Why can’t I connect to an S3 bucket using a gateway VPC endpoint?^]
+
An alternative is to provide the connection by using a NAT Gateway.
+
NOTE: You can't use a proxy to get to S3 over the internet.

== Deploying the Cloud Compliance instance

link:task_deploy_cloud_compliance.html[Deploy Cloud Compliance in Cloud Manager^] if there isn't already an instance deployed.

You need to deploy the instance in an AWS Connector so that Cloud Manager automatically discovers the S3 buckets in this AWS account and displays them in an Amazon S3 working environment.

*Note:* Deploying Cloud Compliance in an on-premises location is not currently supported when scanning S3 buckets.

== Activating Compliance on your S3 working environment

Enable Cloud Compliance on Amazon S3 after you verify the prerequisites.

.Steps

. At the top of Cloud Manager, click *Canvas*.

. Select the Amazon S3 working environment.
+
image:screenshot_s3_we.gif[A screenshot of an Amazon S3 working environment icon]

. In the pane on the right, click *Enable Compliance*.
+
image:screenshot_s3_enable_compliance.gif[A screenshot of enabling the Cloud Compliance service from the Services panel]

. When prompted, assign an IAM role to the Cloud Compliance instance that has <<Requirements specific to S3,the required permissions>>.
+
image:screenshot_s3_compliance_iam_role.gif[A screenshot of entering the AWS IAM role for Cloud Compliance]

. Click *Enable Compliance*.

TIP: You can also enable compliance scans for a working environment from the Scan Configuration page by clicking the image:screenshot_gallery_options.gif[] button and selecting *Activate Compliance*.

.Result

Cloud Manager assigns the IAM role to the instance.

== Enabling and disabling compliance scans on S3 buckets

After Cloud Manager enables Cloud Compliance on Amazon S3, the next step is to configure the buckets that you want to scan.

When Cloud Manager is running in the AWS account that has the S3 buckets you want to scan, it discovers those buckets and displays them in an Amazon S3 working environment.

Cloud Compliance can also <<Scanning buckets from additional AWS accounts,scan S3 buckets that are in different AWS accounts>>.

.Steps

. Select the Amazon S3 working environment.

. In the pane on the right, click *Configure Buckets*.
+
image:screenshot_s3_configure_buckets.gif[A screenshot of clicking Configure Buckets to choose the S3 buckets you want to scan]

. Enable compliance on the buckets that you want to scan.
+
image:screenshot_s3_select_buckets.gif[A screenshot of selecting the S3 buckets you want to scan]

.Result

Cloud Compliance starts scanning the S3 buckets that you enabled. If there are any errors, they'll appear in the Status column, alongside the required action to fix the error.

== Scanning buckets from additional AWS accounts

You can scan S3 buckets that are under a different AWS account by assigning a role from that account to access the existing Cloud Compliance instance.

.Steps

. Go to the target AWS account where you want to scan S3 buckets and create an IAM role by selecting *Another AWS account*.
+
image:screenshot_iam_create_role.gif[]
+
Be sure to do the following:

* Enter the ID of the account where the Cloud Compliance instance resides.
* Change the *Maximum CLI/API session duration* from 1 hour to 12 hours and save that change.
* Attach the Cloud Compliance IAM policy. Make sure it has the required permissions.
+
[source,json]
{
  "Version": "2012-10-17",
  "Statement": [
      {
          "Effect": "Allow",
          "Action": [
              "s3:Get*",
              "s3:List*",
              "s3:PutObject",
              "s3:HeadBucket"
          ],
          "Resource": "*"
      },
  ]
}

. Go to the source AWS account where the Cloud Compliance instance resides and select the IAM role that is attached to the instance.
.. Change the *Maximum CLI/API session duration* from 1 hour to 12 hours and save that change.
.. Click *Attach policies* and then click *Create policy*.
.. Create a policy that includes the "sts:AssumeRole" action and the ARN of the role that you created in the target account.
+
[source,json]
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": "sts:AssumeRole",
            "Resource": "arn:aws:iam::<ADDITIONAL-ACCOUNT-ID>:role/<ADDITIONAL_ROLE_NAME>"
        },
        {
            "Effect": "Allow",
            "Action": [
                "iam:GetPolicyVersion",
                "iam:GetPolicy",
                "iam:ListAttachedRolePolicies"
            ],
            "Resource": [
                "arn:aws:iam::*:policy/*",
                "arn:aws:iam::*:role/*"
            ]
        }
    ]
}
+
The Cloud Compliance instance profile account now has access to the additional AWS account.

. Go to the *Amazon S3 Scan Configuration* page and the new AWS account is displayed. Note that it can take a few minutes for Cloud Compliance to sync the new account’s working environment and show this information.
+
image:screenshot_activate_and_select_buckets.png[]

. Click *Activate Compliance & Select Buckets* and select the buckets you want to scan.

.Result

Cloud Compliance starts scanning the new S3 buckets that you enabled.
